```{r echo = FALSE}
knitr::opts_chunk$set(out.width = "100%")
```

# (PART\*) Human Genetic Variation in MAGE {-}   

# Overview {#human-genetic-variation-in-mage-overview}

Introduce AnVIL, Bioconductor, and Galaxy using MAGE

## Learning Objectives

1. Explore MAGE Workspace 
1. Analysis with Jupyter/Terminal
1. Bioconductor with RStudio
1. Workflows with Galaxy

# Preparation {#human-genetic-variation-in-mage-preparation}

## Review Background

Learn how the NHGRI Genomic Data Science Analysis, Visualization, and Informatics Lab-Space, or AnVIL, inverts the model of genomics data sharing by providing a cloud environment for the analysis of large genomic and related datasets (see [slidedeck](https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit?slide=id.g336d9ca244f_0_6#slide=id.g336d9ca244f_0_6)).

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g36a25834c74_19_108
")
```

## Create AnVIL Account

Follow these instructions to create an AnVIL Account

- https://jhudatascience.org/AnVIL_Book_Getting_Started/data-analysts.html#data-analysts-step-1

::: {.notice}
Fill out [this poll](https://docs.google.com/forms/d/e/1FAIpQLScEF5Z9alzqEM3XfFFCFTcBDdm2MxCciSaMRTPehALHz4CsiA/viewform) to share your AnVIL ID
:::

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_0")
```

## Clone Workspace

Navigate to `demos-explore-mage` and clone the Workspace

- https://anvil.terra.bio/#workspaces/anvil-outreach/demos-explore-mage

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g36877bec10a_0_0")
```

# Exercises {#human-genetic-variation-in-mage-exercises}

## Explore MAGE Workspace

The demos-explore-mage Workspace allows you to explore how data is organized on AnVIL using a subset of data from the [Multi-ancestry Analysis of Gene Expression](https://pubmed.gov/39020179) (MAGE) and [1000 Genomes Project](https://www.internationalgenome.org) (1KGP) projects.
Importantly, pay close attention to the relationship between file **links** in Data Tables and the actual files in Workspace Buckets, especially after cloning a Workspace.
You can navigate to MAGE Workspace directly through this link: 

- https://anvil.terra.bio/#workspaces/anvil-outreach/demos-explore-mage

Key components of this Workspace are:

1. DASHBOARD tab - which will tell you more about the Workspace.
1. DATA tab - which has Data Tables with links to data relevant for demo exercises.
1. ANALYSES tab - which has notebooks relevant for demo exercises with Jupyter and RStudio.
1. 'Environment Configuration' button - to select the Cloud Environment of choice.
1. 'Browse workspace files' button - which contains any files stored in this Workspace (see Review Key Concepts for important note about Cloned Workspaces) as well as notebooks listed in the ANALYSES tab.

### Review Key Concepts

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g33d1f69b524_1_1")
```

### Scavenger Hunt

Original Workspace

- https://anvil.terra.bio/#workspaces/anvil-outreach/demos-explore-mage
- Explore Data Tables e.g. counts.csv, PCA.nb.html
- Find files in Workspace Bucket

Your Cloned Workspace

- https://anvil.terra.bio/#workspaces/ &lt;billing-project&gt; / &lt;workspace-name&gt;
- Explore Data Tables
- Look for files in Workspace Bucket

## Analysis with Jupyter/Terminal

### Launch Jupyter

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/1-IU5l40UxmpoBqFimSUmT1PNEUij2UnXMslOsiG5ncE/edit#slide=id.g14ea2db115d_0_22")
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/1-IU5l40UxmpoBqFimSUmT1PNEUij2UnXMslOsiG5ncE/edit#slide=id.g14ea2db115d_0_18")
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/1-IU5l40UxmpoBqFimSUmT1PNEUij2UnXMslOsiG5ncE/edit#slide=id.g14ea2db115d_0_41")
```

### Review Key Concepts

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_158")
```

### Enter Terminal

Copy a file from the original Workspace Bucket to your Persistent Disk using `gcloud storage`

```
gcloud storage cp gs://fc-8c4a998b-0e6f-4750-b6de-c2d8a2da9d90/sample.metadata.MAGE.v1.0.txt .
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_32")
```

### Run Jupyter Notebook

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_36")
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/1-IU5l40UxmpoBqFimSUmT1PNEUij2UnXMslOsiG5ncE/edit#slide=id.g25442045568_0_82")
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_40")
```

### Next Steps

## Bioconductor with RStudio

### Launch RStudio

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/1a35Mb8f0M-bQkBcHa1cyQc6YxXoBLtExCz96nv08vkA/edit#slide=id.g14ea2db115d_0_18")
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/1a35Mb8f0M-bQkBcHa1cyQc6YxXoBLtExCz96nv08vkA/edit#slide=id.g256428d32e5_0_10")
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_71")
```

### Review Key Concepts

### Use AnVILGCP

Copy a file to your Persistent Disk using the link in the Data Table and the Bioconductor [AnVILGCP](https://bioconductor.org/packages/AnVILGCP) package

```
BiocManager::install( "AnVILGCP" )
library( "AnVILGCP" )
avtable( "MAGE" )
gcloud_storage( paste( "cp", avtable( "MAGE" )[2,2], "." ) )
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_80")
```

### Run R Notebook

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_84")
```

### Next Steps

## Workflows with Galaxy

### Launch Galaxy

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/1yYCg4cPVBMMDghT17B4XzROieqyMH99Ex9nMm_Scm9Q/edit#slide=id.ge1182914a6_0_36")
```

### Review Key Concepts

### Run FastQC

Copy a file to your Persistent Disk using the Galaxy Upload tool

- Click "Upload" in the left hand menu
- Click "Choose remote files" at the bottom
- Select the `demos-explore-mage` Workspace
- Select `Tables` and then `1KGP`
- Tick the box next to `NA12878.1mil.fastq.gz` and click "Ok"
- Click "Start" and then "Close"

You can now

- Run the FastQC tool and view FastQC on data 1: Webpage
- Export data back to AnVIL using "Export History to File" (must target `Other Data/Files`)

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_90")
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_96")
```

### Install Tool

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_100")
```

### Next Steps

# Wrap Up {#human-genetic-variation-in-mage-wrap-up}

## Shut Down Compute

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_110")
```

## Learn More

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_136")
```

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_126")
```

## Provide Feedback

::: {.notice}
Fill out [this poll](https://docs.google.com/forms/d/e/1FAIpQLScrDVb_utm55pmb_SHx-RgELTEbCCWdLea0T3IzS0Oj00GE4w/viewform?usp=pp_url&entry.1565230805=GBCC2025) to share your feedback
:::

```{r, echo=FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/16DHXD2KNyjjP2mKzPDHmNE9loYy6OgqGG0-Kn8CLFak/edit#slide=id.g369240085c8_0_120")
```
